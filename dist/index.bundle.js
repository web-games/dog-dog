(()=>{"use strict";var t,n=(t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)},function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});const e=function(t){function e(n){var o=t.call(this,n)||this;return e.NAME="DOG"+e.COUNT++,o.view.style.width="100%",document.body.prepend(o.view),o}return n(e,t),Object.defineProperty(e.prototype,"stageWidth",{get:function(){return this.screen.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stageHeight",{get:function(){return this.screen.height},enumerable:!1,configurable:!0}),e.NAME="DOG",e.COUNT=0,e}(PIXI.Application);var o=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const r=function(t){function n(n){var e=t.call(this)||this;return e.game=null,e.stageWidth=0,e.stageHeight=0,e.game=n,e.stageWidth=n.stageWidth,e.stageHeight=n.stageHeight,e}return o(n,t),n.prototype.init=function(t){},n.prototype.destroy=function(){},n.prototype.removeAllChildren=function(t,n,e){void 0===e&&(e=1);var o=t.children;if(o&&o.length>0)for(var r=o.length-1;r>=0;r--){var i=o[r];console.log(e,r,i.name),this.removeAllChildren(i,e+1),i.parent&&i.parent.removeChild(i)}n&&t.parent&&t.parent.removeChild(t)},n}(PIXI.Container);var i=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),a=PIXI.Text,c=PIXI.Container,s=PIXI.Graphics;const u=function(t){function n(n){var e=t.call(this,n)||this;return e.loading=!0,e._loadingText=null,e._loadingBar=null,e}return i(n,t),n.prototype.init=function(){var t=this,e=new s;e.beginFill(window.themeColor),e.drawRect(0,0,this.stageWidth,this.stageHeight),e.endFill(),e.x=0,e.y=0,this.addChild(e),e.interactive=!0,e.on("pointerdown",(function(){!t.loading&&t.emit(n.CLICK_CONTINUE)}));var o=new c;this.addChild(o),o.x=(this.stageWidth-300)/2,o.y=this.stageHeight-300;var r=new s;r.lineStyle(2,16777215,1),r.beginFill(3308539,0),r.drawRoundedRect(0,0,300,16,8),r.endFill(),o.addChild(r);var i=new PIXI.filters.GlowFilter({distance:16,outerStrength:2,innerStrength:0,color:16777215,quality:.1,knockout:!1});r.filters=[i];var u=new s;u.beginFill(16777215,1),u.drawRect(0,0,300,16),u.endFill(),o.addChild(u),u.x=-300,u.y=0;var l=new s;l.beginFill(16711680,1),l.drawRoundedRect(0,0,300,16,8),l.endFill(),o.addChild(l),u.mask=l,this._loadingBar=u;var p=new a("加载中...",{fill:"#FFFFFF"});o.addChild(p),p.anchor.set(.5,.5),p.x=150,p.y=-30,this._loadingText=p,this.emit("init_complete")},n.prototype.setLoadingProgress=function(t){TweenMax.to(this._loadingBar,.3,{x:t/100*300-300}),this.setLoadingText("".concat(parseInt(t),"%"))},n.prototype.setLoadingText=function(t){this._loadingText.text=t},n.NAME="loading_scene",n.CLICK_CONTINUE="click_continue",n}(r);var l=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const p=function(t){function n(e){var o=t.call(this,n.NAME,e)||this;return o.loadingScene.on("init_complete",o.initComplete,o),o.loadingScene.on(u.CLICK_CONTINUE,(function(){o.sendNotification(K.TO_START,{from:o.loadingScene})}),o),o}return l(n,t),n.prototype.initComplete=function(){var t=this,n=new PIXI.Loader;n.add(["./resources/images/animal1.png","./resources/images/animal2.png","./resources/images/animal3.png","./resources/images/animal4.png","./resources/images/animal5.png","./resources/images/animal6.png","./resources/images/animal7.png","./resources/images/animal8.png","./resources/images/animal9.png","./resources/images/animal10.png","./resources/images/animal11.png","./resources/images/animal12.png","./resources/images/animal13.png","./resources/images/animal14.png","./resources/images/animal15.png"]),n.once("complete",(function(){t.loadingScene.setLoadingText("加载完成，点击任意地方继续"),t.loadingScene.loading=!1})),n.on("progress",(function(n){t.loadingScene.setLoadingProgress(n.progress)})),n.load()},Object.defineProperty(n.prototype,"loadingScene",{get:function(){return this.viewComponent},enumerable:!1,configurable:!0}),n.NAME="loading_scene_mediator",n}(puremvc.Mediator);var f=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),h=PIXI.Container,d=PIXI.Text,y=PIXI.Graphics;const _=function(t){function n(n,e){void 0===n&&(n="");var o=t.call(this)||this,r=new y;o.addChild(r);var i=(null==e?void 0:e.fontSize)||32,a=(null==e?void 0:e.color)||16777215,c=new d(n,{fill:a,fontSize:i});c.anchor.set(.5,.5),o.addChild(c);var s=c.width+40,u=c.height+20,l=(null==e?void 0:e.bgColor)||window.themeColor;return r.beginFill(l),r.drawRoundedRect(-s/2,-u/2,s,u,8),r.endFill(),o.interactive=!0,o}return f(n,t),n}(h);var v=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const g=function(t){function n(n){var e=t.call(this,n)||this;return e._ticker=null,e}return v(n,t),n.prototype.init=function(){var t=this;this.addBackground();var n=new _("开始游戏");n.x=this.stageWidth/2,n.y=this.stageHeight/2,n.scale.x=n.scale.y=0,this.addChild(n),n.interactive=!0,n.on("pointerdown",(function(){t.sceneOut()})),TweenMax.to(n.scale,1,{x:1,y:1,ease:Elastic.easeOut,delay:.3})},n.prototype.addBackground=function(){return t=this,n=void 0,o=function(){var t,n,e,o,r,i,a;return function(t,n){var e,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(t){i=[6,t],o=0}finally{e=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(c){switch(c.label){case 0:return t=this.stageWidth,n=this.stageHeight,[4,fetch("./resources/shader/smog.frag").then((function(t){return t.text()}))];case 1:return e=c.sent(),o={u_resolution:new PIXI.Point(t,n),alpha:1,shift:1.6,time:0,speed:new PIXI.Point(.1,.05)},r=new PIXI.Filter("",e,o),(i=PIXI.Sprite.from("./resources/images/pixi_v3_github-pad.png")).filters=[r],i.width=t,i.height=n,this.addChildAt(i,0),(a=new PIXI.Ticker).add((function(t){o.time+=.01})),a.start(),this._ticker=a,[2]}}))},new((e=void 0)||(e=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function c(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,c)}s((o=o.apply(t,n||[])).next())}));var t,n,e,o},n.prototype.destroy=function(){this._ticker.stop()},n.prototype.sceneIn=function(){TweenMax.to(this,1,{alpha:1})},n.prototype.sceneOut=function(){var t=this;TweenMax.to(this,.3,{alpha:0,onComplete:function(){t.emit(n.CLICK_START)}})},n.NAME="start_scene",n.CLICK_START="click_start",n}(r);var m=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const C=function(t){function n(e){var o=t.call(this,n.NAME,e)||this;return o.startScene.on(g.CLICK_START,(function(){return o.sendNotification(K.TO_GAME,{from:o.startScene})})),o}return m(n,t),n.prototype.listNotificationInterests=function(){return[]},n.prototype.handleNotification=function(t){t.getName()},Object.defineProperty(n.prototype,"startScene",{get:function(){return this.viewComponent},enumerable:!1,configurable:!0}),n.NAME="start_scene_mediator",n}(puremvc.Mediator);var w=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const O=function(t){function n(){var e=t.call(this,n.NAME)||this;return e.mapData=null,e.chooseCardList=null,e.chooseCardMap=null,e.mapData=new b(e),e}return w(n,t),n.prototype.initGameData=function(){this.mapData.initMapData(),this.chooseCardList=[],this.chooseCardMap=new Map},n.prototype.insertCard=function(t){if(this.chooseCardList.length>=100)return!1;var n=t.value;return this.chooseCardList.push(t),this.chooseCardMap.get(n)||this.chooseCardMap.set(n,[]),this.chooseCardMap.get(n).push(t),!0},n.NAME="game_proxy",n.CHANGE_COVER_STATUS="change_cover_status",n}(puremvc.Proxy);Array.prototype.shuffle=function(){for(var t,n,e=this.length;e;)t=Math.floor(Math.random()*e--),n=this[e],this[e]=this[t],this[t]=n;return this};const b=function(){function t(t){this.coverData=[],this.data=[],this.rows=16,this.cols=16,this.layers=5,this.proxy=null,this.proxy=t}return t.prototype.initMapData=function(){var t=this,n=t.layers,e=t.rows,o=t.cols;this.data=Array.apply(null,{length:n}).map((function(t,n){return Array.apply(null,{length:e}).map((function(){return Array.apply(null,{length:o}).map((function(){return 0}))}))})),this.coverData=JSON.parse(JSON.stringify(this.data));for(var r=0;r<n;r++)for(var i=0;i<e;i++)for(var a=0;a<o;a++)if(Math.random()<.1&&!this.check8direction(r,i,a)){var c=parseInt(String(7*Math.random()))+9;this.data[r][i][a]=c,this.coverData[r][i][a]=1}console.log("this.data:",this.data)},t.prototype.checkCoverRelationship=function(t){void 0===t&&(t=0);for(var n=this,e=n.layers,o=n.rows,r=n.cols,i=Array.apply(null,{length:o}).map((function(){return Array.apply(null,{length:r}).map((function(){return 0}))})),a=[],c=0;c<e;c++)for(var s=0;s<o;s++)for(var u=0;u<r;u++)0!==this.data[c][s][u]&&0===this.check4Grid(i,s,u)&&1===this.coverData[c][s][u]&&(this.coverData[c][s][u]=0,a.push({layer:c,row:s,col:u}));this.proxy.sendNotification(O.CHANGE_COVER_STATUS,a)},t.prototype.setGridStatus=function(t){var n=t.layer,e=t.row,o=t.col,r=t.value,i=t.cover;this.data[n][e][o]=r,this.coverData[n][e][o]=i},t.prototype.check4Grid=function(t,n,e){var o=0;return[[0,0],[0,1],[1,0],[1,1]].forEach((function(r){var i=r[0],a=r[1],c=n+i,s=e+a;1===t[c][s]&&(o=1),t[c][s]=1})),o},t.prototype.check8direction=function(t,n,e){for(var o=[[0,-1],[0,1],[-1,0],[1,0],[-1,-1],[-1,1],[1,-1],[1,1]],r=0;r<o.length;r++){var i=n+o[r][0],a=e+o[r][1];if(i<0||i>=this.rows)return!0;if(a<0||a>=this.cols)return!0;if(0!==this.data[t][i][a])return!0}return!1},t.GridWidth=40,t.GridHeight=40,t}();var A=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const S=function(t){function n(n,e,o,r,i){var a=t.call(this)||this;a.scene=null,a.graphics=null,a.text=null,a.layer=null,a.row=null,a.col=null,a.value=null,a.scene=n,a.layer=e,a.row=o,a.col=r,a.value=i;var c=new PIXI.Graphics;c.beginFill(16119285),c.drawRect(-39,-39,78,78),c.endFill(),a.addChild(c);var s=PIXI.Sprite.from("./resources/images/animal".concat(i,".png"));a.addChild(s),s.width=78,s.height=78,s.anchor.set(.5);var u=new PIXI.Graphics;return u.beginFill(0,.5),u.drawRect(-39,-39,78,78),u.endFill(),a.addChild(u),a.graphics=u,a}return A(n,t),n.prototype.setState=function(t){var n=this;0===t&&(this.graphics.visible=!1,this.buttonMode=!0,this.interactive=!0,this.on("pointerover",(function(t){n.filters=[new PIXI.filters.OutlineFilter(2,10092441)]})),this.on("pointerout",(function(t){n.filters=[]})),this.on("pointertap",(function(t){n.scene.emit(N.CLICK_CARD,t.currentTarget)})))},n}(PIXI.Container);var T=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),E=function(){return E=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t},E.apply(this,arguments)};const P=function(t){function n(){return t.call(this)||this}return T(n,t),n.prototype.execute=function(t){console.log("SceneCommand notification:",t);var e=t.getName(),o=t.getBody(),r=this.facade.retrieveProxy(O.NAME),i=this.facade.retrieveMediator(R.NAME).gameScene;switch(e){case n.GAME_START:r.initGameData(),this.sendNotification(K.TO_GAME,{from:o});break;case n.CARD_CHECK:if(!r.insertCard(o))return;i.moveCard(o,r.chooseCardList),r.mapData.setGridStatus(E(E({},o),{value:0,cover:0})),r.mapData.checkCoverRelationship(o.layer);break;case n.CHECK_OVER_RELATIONSHIP:r.mapData.checkCoverRelationship(o.layer);break;case n.GAME_OVER:break;case n.CHECK_SAME_CARD:var a=o.value,c=r.chooseCardMap.get(a);if(c.length>=3){for(var s=c.length-1;s>=0;s--){var u=c.splice(s,1)[0];i.removeCard(u);var l=r.chooseCardList.indexOf(u);-1!==l&&r.chooseCardList.splice(l,1)}i.resetChooseCardPosition(r.chooseCardList)}}},n.GAME_START="game_start",n.CHECK_OVER_RELATIONSHIP="check_over_relationship",n.CARD_CHECK="card_check",n.GAME_OVER="game_over",n.CHECK_SAME_CARD="check_same_card",n}(puremvc.SimpleCommand);var I=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),x=PIXI.Container,M=PIXI.Graphics;const N=function(t){function n(n){var e=t.call(this,n)||this;return e.cards={},e.animalContainer=null,e}return I(n,t),n.prototype.init=function(n){t.prototype.init.call(this,n);var e=n.rows,o=n.cols,r=n.layers,i=n.data,a=new M;a.beginFill(window.themeColor),a.drawRect(0,0,this.stageWidth,this.stageHeight),a.endFill(),a.x=0,a.y=0,this.addChild(a);var c=new x;this.addChild(c),this.animalContainer=c,this.animalContainer.x=(this.stageWidth-o*b.GridWidth)/2,this.animalContainer.y=(this.stageHeight-e*b.GridHeight)/2;for(var s=r-1;s>=0;s--)for(var u=0;u<e;u++)for(var l=0;l<o;l++){var p=i[s][u][l];p&&this.addCard({layer:s,row:u,col:l,value:p,x:l*b.GridWidth,y:u*b.GridHeight})}this.emit("init_complete")},n.prototype.addCard=function(t){var n=t.layer,e=t.row,o=t.col,r=t.x,i=t.y,a=t.value,c=new S(this,n,e,o,a);return this.animalContainer.addChild(c),c.x=r,c.y=i,this.cards["".concat(n,"_").concat(e,"_").concat(o)]=c,c},n.prototype.moveCard=function(t,n){var e=this,o=t.layer,r=t.row,i=t.col,a=this.cards["".concat(o,"_").concat(r,"_").concat(i)];if(a){var c=a.toGlobal(new PIXI.Point),s=c.x,u=c.y,l=n.length*(2*b.GridWidth),p=2*b.GridHeight;this.addChild(a),a.x=s,a.y=u,TweenMax.to(a,.5,{x:l,y:p,onComplete:function(){e.emit(P.CHECK_SAME_CARD,t)}})}},n.prototype.removeCard=function(t){var n=t.layer,e=t.row,o=t.col,r=this.cards["".concat(n,"_").concat(e,"_").concat(o)];r&&this.removeChild(r)},n.prototype.resetChooseCardPosition=function(t){var n=this;t.forEach((function(t,e){var o=t.layer,r=t.row,i=t.col,a=n.cards["".concat(o,"_").concat(r,"_").concat(i)];if(a){var c=(e+1)*(2*b.GridWidth),s=2*b.GridHeight;TweenMax.to(a,.3,{x:c,y:s})}}))},n.prototype.setCardStatus=function(t){var n=this;t.forEach((function(t){var e=t.layer,o=t.row,r=t.col;n.cards["".concat(e,"_").concat(o,"_").concat(r)].setState(0)}))},n.NAME="game_scene",n.CLICK_CARD="click_fruit",n}(r);var j=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const R=function(t){function n(e){var o=t.call(this,n.NAME,e)||this;return o.gameScene.on("init_complete",(function(){return o.sendNotification(P.CHECK_OVER_RELATIONSHIP,{layer:0})})),o.gameScene.on(N.CLICK_CARD,(function(t){var n=t.layer,e=t.row,r=t.col,i=t.value;return o.sendNotification(P.CARD_CHECK,{layer:n,row:e,col:r,value:i})})),o.gameScene.on(P.CHECK_SAME_CARD,(function(t){return o.sendNotification(P.CHECK_SAME_CARD,t)})),o}return j(n,t),n.prototype.listNotificationInterests=function(){return[O.CHANGE_COVER_STATUS]},n.prototype.handleNotification=function(t){console.log("GameSceneMediator notification:",t);var n=t.getName(),e=t.getBody();t.getType(),n===O.CHANGE_COVER_STATUS&&this.gameScene.setCardStatus(e)},Object.defineProperty(n.prototype,"gameScene",{get:function(){return this.viewComponent},enumerable:!1,configurable:!0}),n.NAME="game_scene_mediator",n}(puremvc.Mediator);var G=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const k=function(t){function n(n){var e=t.call(this,n)||this;return e._ticker=null,e}return G(n,t),n.prototype.init=function(){var t=this;this.addBackground();var e=new _("再来一次");e.x=this.stageWidth/2,e.y=this.stageHeight/2,e.interactive=!0,e.on("pointerdown",(function(){return t.emit(n.CLICK_AGAIN)})),this.addChild(e);var o=new _("重新开始");o.x=this.stageWidth/2,o.y=this.stageHeight/2+110,o.interactive=!0,o.on("pointerdown",(function(){return t.emit(n.CLICK_RESTART)})),this.addChild(o)},n.prototype.addBackground=function(){return t=this,n=void 0,o=function(){var t,n,e,o,r,i,a;return function(t,n){var e,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(t){i=[6,t],o=0}finally{e=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(c){switch(c.label){case 0:return t=this.stageWidth,n=this.stageHeight,[4,fetch("./resources/shader/smog.frag").then((function(t){return t.text()}))];case 1:return e=c.sent(),o={u_resolution:new PIXI.Point(t,n),alpha:1,shift:1.6,time:0,speed:new PIXI.Point(.1,.05)},r=new PIXI.Filter("",e,o),(i=PIXI.Sprite.from("./resources/images/pixi_v3_github-pad.png")).filters=[r],i.width=t,i.height=n,this.addChildAt(i,0),(a=new PIXI.Ticker).add((function(t){o.time+=.01,console.log("update")})),a.start(),this._ticker=a,[2]}}))},new((e=void 0)||(e=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function c(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,c)}s((o=o.apply(t,n||[])).next())}));var t,n,e,o},n.prototype.destroy=function(){this._ticker.stop()},n.NAME="start_scene",n.CLICK_AGAIN="click_again",n.CLICK_RESTART="click_restart",n}(r);var H=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const D=function(t){function n(e){var o=t.call(this,n.NAME,e)||this;return o.endScene.on(k.CLICK_AGAIN,(function(){o.sendNotification(K.TO_GAME,{from:o.endScene})})),o.endScene.on(k.CLICK_RESTART,(function(){o.sendNotification(K.TO_START,{from:o.endScene})})),o}return H(n,t),n.prototype.listNotificationInterests=function(){return[]},n.prototype.handleNotification=function(t){t.getName()},Object.defineProperty(n.prototype,"endScene",{get:function(){return this.viewComponent},enumerable:!1,configurable:!0}),n.NAME="end_scene_mediator",n}(puremvc.Mediator);var L=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const K=function(t){function n(){return t.call(this)||this}return L(n,t),n.prototype.execute=function(t){console.log("SceneCommand notification:",t);var e=this.facade.application,o=t.getName(),r=t.getBody().from;r&&(r.destroy(),r.parent&&r.parent.removeChild(r));var i=this.facade.retrieveProxy(O.NAME);switch(o){case n.TO_LOADING:var a=this.facade.retrieveMediator(p.NAME).loadingScene;e.stage.addChild(a),a.init();break;case n.TO_START:var c=this.facade.retrieveMediator(C.NAME).startScene;e.stage.addChild(c),c.sceneIn(),c.init();break;case n.TO_GAME:i.initGameData();var s=this.facade.retrieveMediator(R.NAME).gameScene;e.stage.addChild(s),s.init(i.mapData);break;case n.TO_END:var u=this.facade.retrieveMediator(D.NAME).endScene;e.stage.addChild(u),u.init()}},n.TO_LOADING="to_loading",n.TO_START="to_start",n.TO_GAME="to_game",n.TO_END="to_end",n}(puremvc.SimpleCommand);var X=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const F=function(t){function n(){return t.call(this)||this}return X(n,t),n.prototype.execute=function(){this.facade.registerProxy(new O)},n}(puremvc.SimpleCommand);var W=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const U=function(t){function n(){return t.call(this)||this}return W(n,t),n.prototype.execute=function(t){var n=t.getBody(),e=new u(n);this.facade.registerMediator(new p(e));var o=new g(n);this.facade.registerMediator(new C(o));var r=new N(n);this.facade.registerMediator(new R(r));var i=new k(n);this.facade.registerMediator(new D(i))},n}(puremvc.SimpleCommand);var V=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const B=function(t){function n(){return t.call(this)||this}return V(n,t),n.prototype.execute=function(){this.facade.registerCommand(K.TO_LOADING,K),this.facade.registerCommand(K.TO_START,K),this.facade.registerCommand(K.TO_GAME,K),this.facade.registerCommand(K.TO_END,K),this.facade.registerCommand(P.GAME_START,P),this.facade.registerCommand(P.GAME_OVER,P),this.facade.registerCommand(P.CARD_CHECK,P),this.facade.registerCommand(P.CHECK_OVER_RELATIONSHIP,P),this.facade.registerCommand(P.CHECK_SAME_CARD,P)},n}(puremvc.SimpleCommand);var z=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const J=function(t){function n(){return t.call(this)||this}return z(n,t),n.prototype.initializeMacroCommand=function(){this.addSubCommand(F),this.addSubCommand(U),this.addSubCommand(B)},n}(puremvc.MacroCommand);var q=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),Q=puremvc.Facade;const Y=function(t){function n(n){var e=t.call(this,n)||this;return e._application=null,e}return q(n,t),n.getInstance=function(t){return null==t?null:(null==Q.instanceMap[t]&&(Q.instanceMap[t]=new n(t)),Q.instanceMap[t])},n.prototype.initializeModel=function(){t.prototype.initializeModel.call(this)},n.prototype.initializeView=function(){t.prototype.initializeView.call(this)},n.prototype.initializeController=function(){t.prototype.initializeController.call(this),this.registerCommand(n.STARTUP,J)},n.prototype.startup=function(){var t=document.documentElement.clientWidth||document.body.clientWidth,o=document.documentElement.clientHeight||document.body.clientHeight,r=o>t?o/t*640:t/o*640;globalThis.__PIXI_APP__=this.application=new e({width:640,height:r,backgroundColor:window.themeColor}),this.sendNotification(n.STARTUP,this.application),this.removeCommand(n.STARTUP),this.sendNotification(K.TO_LOADING,{from:null})},n.prototype.destroy=function(){this.application&&(this.application.destroy(!0),this.application=null),TweenMax.killAll()},Object.defineProperty(n.prototype,"application",{get:function(){return this._application},set:function(t){this._application=t},enumerable:!1,configurable:!0}),n.STARTUP="startup",n.instance=null,n}(Q);window.themeColor=13383551,Y.getInstance(e.NAME).startup()})();