(()=>{"use strict";var t,e=(t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)});const n=function(t){function n(e){var o=t.call(this,e)||this;return n.NAME="DOG"+n.COUNT++,o.view.style.width="100%",document.body.prepend(o.view),o}return e(n,t),Object.defineProperty(n.prototype,"stageWidth",{get:function(){return this.screen.width},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"stageHeight",{get:function(){return this.screen.height},enumerable:!1,configurable:!0}),n.NAME="DOG",n.COUNT=0,n}(PIXI.Application);var o=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const r=function(t){function e(e){var n=t.call(this)||this;return n.game=null,n.stageWidth=0,n.stageHeight=0,n.game=e,n.stageWidth=e.stageWidth,n.stageHeight=e.stageHeight,n}return o(e,t),e.prototype.init=function(t){},e.prototype.destroy=function(){},e.prototype.removeAllChildren=function(t,e,n){if(void 0===t&&(t=this),void 0===e&&(e=!0),void 0===n&&(n=0),t){for(var o=t.children;o&&o.length;){var r=o.shift();this.removeAllChildren(r,!0,n+1)}e&&t.parent&&t.parent.removeChild(t)}},e}(PIXI.Container);var i=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=PIXI.Text,c=PIXI.Container,s=PIXI.Graphics;const u=function(t){function e(e){var n=t.call(this,e)||this;return n.loading=!0,n._loadingText=null,n._loadingBar=null,n}return i(e,t),e.prototype.init=function(){var t=this,n=new s;n.beginFill(window.themeColor),n.drawRect(0,0,this.stageWidth,this.stageHeight),n.endFill(),n.x=0,n.y=0,this.addChild(n),n.interactive=!0,n.on("pointerdown",(function(){!t.loading&&t.emit(e.CLICK_CONTINUE)})),n.name="screen_bg";var o=new c;this.addChild(o),o.x=(this.stageWidth-300)/2,o.y=this.stageHeight-300,o.name="loading_bar_container";var r=new s;r.lineStyle(2,16777215,1),r.beginFill(3308539,0),r.drawRoundedRect(0,0,300,16,8),r.endFill(),o.addChild(r);var i=new PIXI.filters.GlowFilter({distance:16,outerStrength:2,innerStrength:0,color:16777215,quality:.1,knockout:!1});r.filters=[i];var u=new s;u.beginFill(16777215,1),u.drawRect(0,0,300,16),u.endFill(),o.addChild(u),u.x=-300,u.y=0;var l=new s;l.beginFill(16711680,1),l.drawRoundedRect(0,0,300,16,8),l.endFill(),o.addChild(l),u.mask=l,this._loadingBar=u;var p=new a("加载中...",{fill:"#FFFFFF"});o.addChild(p),p.anchor.set(.5,.5),p.x=150,p.y=-30,this._loadingText=p,this.emit("init_complete")},e.prototype.setLoadingProgress=function(t){TweenMax.to(this._loadingBar,.3,{x:t/100*300-300}),this.setLoadingText("".concat(parseInt(t),"%"))},e.prototype.setLoadingText=function(t){this._loadingText.text=t},e.NAME="loading_scene",e.CLICK_CONTINUE="click_continue",e}(r);Array.prototype.shuffle=function(){for(var t,e,n=this.length;n;)t=Math.floor(Math.random()*n--),e=this[n],this[n]=this[t],this[t]=e;return this};const l=function(){function t(t){this.coverData=[],this.data=[],this.rows=16,this.cols=16,this.layers=5,this.proxy=null,this.proxy=t}return t.prototype.initMapData=function(){var t=this,e=t.layers,n=t.rows,o=t.cols;this.data=Array.apply(null,{length:e}).map((function(t,e){return Array.apply(null,{length:n}).map((function(){return Array.apply(null,{length:o}).map((function(){return 0}))}))})),this.coverData=JSON.parse(JSON.stringify(this.data));for(var r=0;r<e;r++)for(var i=0;i<n;i++)for(var a=0;a<o;a++)if(Math.random()<.1&&!this.check8direction(r,i,a)){var c=parseInt(String(7*Math.random()))+9;this.data[r][i][a]=c,this.coverData[r][i][a]=1}console.log("this.data:",this.data)},t.prototype.checkCoverRelationship=function(t){void 0===t&&(t=0);for(var e=this,n=e.layers,o=e.rows,r=e.cols,i=Array.apply(null,{length:o}).map((function(){return Array.apply(null,{length:r}).map((function(){return 0}))})),a=[],c=0;c<n;c++)for(var s=0;s<o;s++)for(var u=0;u<r;u++)0!==this.data[c][s][u]&&0===this.check4Grid(i,s,u)&&1===this.coverData[c][s][u]&&(this.coverData[c][s][u]=0,a.push({layer:c,row:s,col:u}));this.proxy.sendNotification(f.CHANGE_COVER_STATUS,a)},t.prototype.setGridStatus=function(t){var e=t.layer,n=t.row,o=t.col,r=t.value,i=t.cover;this.data[e][n][o]=r,this.coverData[e][n][o]=i},t.prototype.check4Grid=function(t,e,n){var o=0;return[[0,0],[0,1],[1,0],[1,1]].forEach((function(r){var i=r[0],a=r[1],c=e+i,s=n+a;1===t[c][s]&&(o=1),t[c][s]=1})),o},t.prototype.check8direction=function(t,e,n){for(var o=[[0,-1],[0,1],[-1,0],[1,0],[-1,-1],[-1,1],[1,-1],[1,1]],r=0;r<o.length;r++){var i=e+o[r][0],a=n+o[r][1];if(i<0||i>=this.rows)return!0;if(a<0||a>=this.cols)return!0;if(0!==this.data[t][i][a])return!0}return!1},t.prototype.checkGridIsAllZero=function(){return!this.data.flat(1/0).some((function(t){return 0!==t}))},t.GridWidth=40,t.GridHeight=40,t}();var p=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const f=function(t){function e(){var n=t.call(this,e.NAME)||this;return n.mapData=null,n.chooseCardList=null,n.chooseCardMap=null,n.mapData=new l(n),n}return p(e,t),e.prototype.initGameData=function(){this.mapData.initMapData(),this.chooseCardList=[],this.chooseCardMap=new Map},e.prototype.insertCard=function(t){if(this.chooseCardList.length>=100)return!1;var e=t.value;return this.chooseCardList.push(t),this.chooseCardMap.get(e)||this.chooseCardMap.set(e,[]),this.chooseCardMap.get(e).push(t),!0},e.NAME="game_proxy",e.CHANGE_COVER_STATUS="change_cover_status",e}(puremvc.Proxy);var h=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const d=function(t){function e(e,n,o,r,i){var a=t.call(this)||this;a.scene=null,a.graphics=null,a.text=null,a.layer=null,a.row=null,a.col=null,a.value=null,a.scene=e,a.layer=n,a.row=o,a.col=r,a.value=i;var c=new PIXI.Graphics;c.beginFill(16119285),c.drawRect(-39,-39,78,78),c.endFill(),a.addChild(c);var s=PIXI.Sprite.from("./resources/images/animal".concat(i,".png"));a.addChild(s),s.width=78,s.height=78,s.anchor.set(.5);var u=new PIXI.Graphics;return u.beginFill(0,.5),u.drawRect(-39,-39,78,78),u.endFill(),a.addChild(u),a.graphics=u,a}return h(e,t),e.prototype.setState=function(t){var e=this;0===t&&(this.graphics.visible=!1,this.buttonMode=!0,this.interactive=!0,this.on("pointerover",(function(t){e.filters=[new PIXI.filters.OutlineFilter(2,10092441)]})),this.on("pointerout",(function(t){e.filters=[]})),this.on("pointertap",(function(t){PIXI.sound.play("swap"),e.scene.emit(v.CLICK_CARD,t.currentTarget)})))},e}(PIXI.Container);var y=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),_=PIXI.Container,g=PIXI.Graphics;const v=function(t){function e(e){var n=t.call(this,e)||this;return n.cards={},n.animalContainer=null,n}return y(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e);var n=e.rows,o=e.cols,r=e.layers,i=e.data,a=new g;a.beginFill(window.themeColor),a.drawRect(0,0,this.stageWidth,this.stageHeight),a.endFill(),a.x=0,a.y=0,this.addChild(a);var c=new _;this.addChild(c),this.animalContainer=c,this.animalContainer.x=(this.stageWidth-o*l.GridWidth)/2+l.GridWidth/2,this.animalContainer.y=(this.stageHeight-n*l.GridHeight)/2;for(var s=r-1;s>=0;s--)for(var u=0;u<n;u++)for(var p=0;p<o;p++){var f=i[s][u][p];f&&this.addCard({layer:s,row:u,col:p,value:f,x:p*l.GridWidth,y:u*l.GridHeight})}this.emit("init_complete")},e.prototype.addCard=function(t){var e=t.layer,n=t.row,o=t.col,r=t.x,i=t.y,a=t.value,c=new d(this,e,n,o,a);return this.animalContainer.addChild(c),c.x=r,c.y=i,this.cards["".concat(e,"_").concat(n,"_").concat(o)]=c,c},e.prototype.moveCard=function(t,e){var n=this,o=t.layer,r=t.row,i=t.col,a=this.cards["".concat(o,"_").concat(r,"_").concat(i)];if(a){var c=a.toGlobal(new PIXI.Point),s=c.x,u=c.y,p=e.length*(2*l.GridWidth),f=2*l.GridHeight;this.addChild(a),a.x=s,a.y=u,TweenMax.to(a,.5,{x:p,y:f,onComplete:function(){n.emit(b.CHECK_SAME_CARD,t)}})}},e.prototype.removeCard=function(t){var e=t.layer,n=t.row,o=t.col,r=this.cards["".concat(e,"_").concat(n,"_").concat(o)];r&&this.removeChild(r)},e.prototype.resetChooseCardPosition=function(t){var e=this;t.forEach((function(t,n){var o=t.layer,r=t.row,i=t.col,a=e.cards["".concat(o,"_").concat(r,"_").concat(i)];if(a){var c=(n+1)*(2*l.GridWidth),s=2*l.GridHeight;TweenMax.to(a,.3,{x:c,y:s})}}))},e.prototype.setCardStatus=function(t){var e=this;t.forEach((function(t){var n=t.layer,o=t.row,r=t.col;e.cards["".concat(n,"_").concat(o,"_").concat(r)].setState(0)}))},e.NAME="game_scene",e.CLICK_CARD="click_fruit",e}(r);var m=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const C=function(t){function e(n){var o=t.call(this,e.NAME,n)||this;return o.gameScene.on("init_complete",(function(){return o.sendNotification(b.CHECK_OVER_RELATIONSHIP,{layer:0})})),o.gameScene.on(v.CLICK_CARD,(function(t){var e=t.layer,n=t.row,r=t.col,i=t.value;return o.sendNotification(b.CARD_CHECK,{layer:e,row:n,col:r,value:i})})),o.gameScene.on(b.CHECK_SAME_CARD,(function(t){return o.sendNotification(b.CHECK_SAME_CARD,t)})),o}return m(e,t),e.prototype.listNotificationInterests=function(){return[f.CHANGE_COVER_STATUS]},e.prototype.handleNotification=function(t){console.log("GameSceneMediator notification:",t);var e=t.getName(),n=t.getBody();t.getType(),e===f.CHANGE_COVER_STATUS&&this.gameScene.setCardStatus(n)},Object.defineProperty(e.prototype,"gameScene",{get:function(){return this.viewComponent},enumerable:!1,configurable:!0}),e.NAME="game_scene_mediator",e}(puremvc.Mediator);var w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),O=function(){return O=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},O.apply(this,arguments)};const b=function(t){function e(){return t.call(this)||this}return w(e,t),e.prototype.execute=function(t){console.log("SceneCommand notification:",t);var n=t.getName(),o=t.getBody(),r=(t.getType(),this.facade.retrieveProxy(f.NAME)),i=this.facade.retrieveMediator(C.NAME).gameScene;switch(n){case e.FIRST_TIME_GAME:PIXI.sound.play("worldscenebgm",{loop:!0});break;case e.GAME_START:r.initGameData(),this.sendNotification(F.TO_GAME,{from:o});break;case e.CARD_CHECK:if(!r.insertCard(o))return;i.moveCard(o,r.chooseCardList),r.mapData.setGridStatus(O(O({},o),{value:0,cover:0})),r.mapData.checkCoverRelationship(o.layer);break;case e.CHECK_OVER_RELATIONSHIP:r.mapData.checkCoverRelationship(o.layer);break;case e.CHECK_SAME_CARD:var a=o.value,c=r.chooseCardMap.get(a);if(c.length>=3){for(var s=c.length-1;s>=0;s--){var u=c.splice(s,1)[0];i.removeCard(u);var l=r.chooseCardList.indexOf(u);-1!==l&&r.chooseCardList.splice(l,1)}i.resetChooseCardPosition(r.chooseCardList)}this.sendNotification(e.CHECK_GAME_OVER);break;case e.CHECK_GAME_OVER:r.mapData.checkGridIsAllZero()&&this.sendNotification(e.GAME_OVER);break;case e.GAME_OVER:this.sendNotification(F.TO_END,{from:i})}},e.FIRST_TIME_GAME="first_time_game",e.GAME_START="game_start",e.CHECK_OVER_RELATIONSHIP="check_over_relationship",e.CARD_CHECK="card_check",e.GAME_OVER="game_over",e.CHECK_SAME_CARD="check_same_card",e.CHECK_GAME_OVER="check_game_over",e}(puremvc.SimpleCommand);var A=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const E=function(t){function e(n){var o=t.call(this,e.NAME,n)||this;return o.loadingScene.on("init_complete",o.initComplete,o),o.loadingScene.on(u.CLICK_CONTINUE,(function(){o.sendNotification(F.TO_START,{from:o.loadingScene}),o.sendNotification(b.FIRST_TIME_GAME,{from:o.loadingScene})}),o),o}return A(e,t),e.prototype.initComplete=function(){var t=this,e=new PIXI.Loader;e.add(["./resources/images/animal1.png","./resources/images/animal2.png","./resources/images/animal3.png","./resources/images/animal4.png","./resources/images/animal5.png","./resources/images/animal6.png","./resources/images/animal7.png","./resources/images/animal8.png","./resources/images/animal9.png","./resources/images/animal10.png","./resources/images/animal11.png","./resources/images/animal12.png","./resources/images/animal13.png","./resources/images/animal14.png","./resources/images/animal15.png"]),e.once("complete",(function(){t.loadingScene.setLoadingText("加载完成，点击任意地方继续"),t.loadingScene.loading=!1})),e.on("progress",(function(e){t.loadingScene.setLoadingProgress(e.progress)})),e.load(),PIXI.sound.add({worldscenebgm:"./resources/music/worldscenebgm.mp3",swap:"./resources/music/swap.mp3",click:"./resources/music/click.mp3"})},Object.defineProperty(e.prototype,"loadingScene",{get:function(){return this.viewComponent},enumerable:!1,configurable:!0}),e.NAME="loading_scene_mediator",e}(puremvc.Mediator);var T=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),I=PIXI.Container,S=PIXI.Text,P=PIXI.Graphics;const M=function(t){function e(e,n){void 0===e&&(e="");var o=t.call(this)||this,r=new P;o.addChild(r);var i=(null==n?void 0:n.fontSize)||32,a=(null==n?void 0:n.color)||16777215,c=new S(e,{fill:a,fontSize:i});c.anchor.set(.5,.5),o.addChild(c);var s=c.width+40,u=c.height+20,l=(null==n?void 0:n.bgColor)||window.themeColor;return r.beginFill(l),r.drawRoundedRect(-s/2,-u/2,s,u,8),r.endFill(),o.interactive=!0,o.on("pointerdown",(function(){PIXI.sound.play("click")})),o}return T(e,t),e}(I);var x=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),N=PIXI.Text;const R=function(t){function e(e){var n=t.call(this,e)||this;return n._ticker=null,n}return x(e,t),e.prototype.init=function(){var t=this;this.addBackground();var e=new N("狗了个狗",{fill:16777215,fontSize:64});e.anchor.set(.5,.5),e.x=this.stageWidth/2,e.y=this.stageHeight/2-160,this.addChild(e);var n=new M("开始游戏");n.x=this.stageWidth/2,n.y=this.stageHeight/2,this.addChild(n),n.interactive=!0,n.on("pointerdown",(function(){return t.sceneOut()})),TweenMax.fromTo(e.scale,1,{x:0,y:0},{x:1,y:1,ease:Elastic.easeOut,delay:.3}),TweenMax.fromTo(n.scale,1,{x:0,y:0},{x:1,y:1,ease:Elastic.easeOut,delay:.45})},e.prototype.addBackground=function(){return t=this,e=void 0,o=function(){var t,e,n,o,r,i,a;return function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(c){switch(c.label){case 0:return t=this.stageWidth,e=this.stageHeight,[4,fetch("./resources/shader/smog.frag").then((function(t){return t.text()}))];case 1:return n=c.sent(),o={u_resolution:new PIXI.Point(t,e),alpha:1,shift:1.6,time:0,speed:new PIXI.Point(.1,.05)},r=new PIXI.Filter("",n,o),(i=PIXI.Sprite.from("./resources/images/pixi_v3_github-pad.png")).filters=[r],i.width=t,i.height=e,this.addChildAt(i,0),(a=new PIXI.Ticker).add((function(t){o.time+=.01})),a.start(),this._ticker=a,[2]}}))},new((n=void 0)||(n=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function c(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}));var t,e,n,o},e.prototype.destroy=function(){this._ticker.stop()},e.prototype.sceneIn=function(){TweenMax.to(this,1,{alpha:1})},e.prototype.sceneOut=function(){var t=this;TweenMax.to(this,.3,{alpha:0,onComplete:function(){t.emit(e.CLICK_START)}})},e.NAME="start_scene",e.CLICK_START="click_start",e}(r);var j=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const G=function(t){function e(n){var o=t.call(this,e.NAME,n)||this;return o.startScene.on(R.CLICK_START,(function(){return o.sendNotification(F.TO_GAME,{from:o.startScene})})),o}return j(e,t),e.prototype.listNotificationInterests=function(){return[]},e.prototype.handleNotification=function(t){t.getName()},Object.defineProperty(e.prototype,"startScene",{get:function(){return this.viewComponent},enumerable:!1,configurable:!0}),e.NAME="start_scene_mediator",e}(puremvc.Mediator);var k=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),H=PIXI.Text;const D=function(t){function e(e){var n=t.call(this,e)||this;return n._ticker=null,n}return k(e,t),e.prototype.init=function(){var t=this;this.addBackground();var n=new H("游戏结束",{fill:16777215,fontSize:64});n.anchor.set(.5,.5),n.x=this.stageWidth/2,n.y=this.stageHeight/2-160,this.addChild(n);var o=new M("再来一次");o.x=this.stageWidth/2,o.y=this.stageHeight/2,o.interactive=!0,o.on("pointerdown",(function(){return t.emit(e.CLICK_AGAIN)})),this.addChild(o);var r=new M("重新开始");r.x=this.stageWidth/2,r.y=this.stageHeight/2+110,r.interactive=!0,r.on("pointerdown",(function(){return t.emit(e.CLICK_RESTART)})),this.addChild(r),TweenMax.fromTo(n.scale,1,{x:0,y:0},{x:1,y:1,ease:Elastic.easeOut,delay:.3}),TweenMax.fromTo(o.scale,1,{x:0,y:0},{x:1,y:1,ease:Elastic.easeOut,delay:.45}),TweenMax.fromTo(r.scale,1,{x:0,y:0},{x:1,y:1,ease:Elastic.easeOut,delay:.6})},e.prototype.addBackground=function(){return t=this,e=void 0,o=function(){var t,e,n,o,r,i,a;return function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(c){switch(c.label){case 0:return t=this.stageWidth,e=this.stageHeight,[4,fetch("./resources/shader/smog.frag").then((function(t){return t.text()}))];case 1:return n=c.sent(),o={u_resolution:new PIXI.Point(t,e),alpha:1,shift:1.6,time:0,speed:new PIXI.Point(.1,.05)},r=new PIXI.Filter("",n,o),(i=PIXI.Sprite.from("./resources/images/pixi_v3_github-pad.png")).filters=[r],i.width=t,i.height=e,this.addChildAt(i,0),(a=new PIXI.Ticker).add((function(t){o.time+=.01})),a.start(),this._ticker=a,[2]}}))},new((n=void 0)||(n=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function c(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}));var t,e,n,o},e.prototype.destroy=function(){this._ticker.stop()},e.NAME="start_scene",e.CLICK_AGAIN="click_again",e.CLICK_RESTART="click_restart",e}(r);var L=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const X=function(t){function e(n){var o=t.call(this,e.NAME,n)||this;return o.endScene.on(D.CLICK_AGAIN,(function(){o.sendNotification(F.TO_GAME,{from:o.endScene})})),o.endScene.on(D.CLICK_RESTART,(function(){o.sendNotification(F.TO_START,{from:o.endScene})})),o}return L(e,t),e.prototype.listNotificationInterests=function(){return[]},e.prototype.handleNotification=function(t){t.getName()},Object.defineProperty(e.prototype,"endScene",{get:function(){return this.viewComponent},enumerable:!1,configurable:!0}),e.NAME="end_scene_mediator",e}(puremvc.Mediator);var K=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const F=function(t){function e(){return t.call(this)||this}return K(e,t),e.prototype.execute=function(t){console.log("SceneCommand notification:",t);var n=this.facade.application,o=t.getName(),r=t.getBody().from;r&&(r.destroy(),r.removeAllChildren());var i=this.facade.retrieveProxy(f.NAME);switch(o){case e.TO_LOADING:var a=this.facade.retrieveMediator(E.NAME).loadingScene;n.stage.addChild(a),a.init();break;case e.TO_START:var c=this.facade.retrieveMediator(G.NAME).startScene;n.stage.addChild(c),c.sceneIn(),c.init();break;case e.TO_GAME:i.initGameData();var s=this.facade.retrieveMediator(C.NAME).gameScene;n.stage.addChild(s),s.init(i.mapData);break;case e.TO_END:var u=this.facade.retrieveMediator(X.NAME).endScene;n.stage.addChild(u),u.init()}},e.TO_LOADING="to_loading",e.TO_START="to_start",e.TO_GAME="to_game",e.TO_END="to_end",e}(puremvc.SimpleCommand);var W=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const V=function(t){function e(){return t.call(this)||this}return W(e,t),e.prototype.execute=function(){this.facade.registerProxy(new f)},e}(puremvc.SimpleCommand);var U=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const z=function(t){function e(){return t.call(this)||this}return U(e,t),e.prototype.execute=function(t){var e=t.getBody(),n=new u(e);this.facade.registerMediator(new E(n));var o=new R(e);this.facade.registerMediator(new G(o));var r=new v(e);this.facade.registerMediator(new C(r));var i=new D(e);this.facade.registerMediator(new X(i))},e}(puremvc.SimpleCommand);var B=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const J=function(t){function e(){return t.call(this)||this}return B(e,t),e.prototype.execute=function(){this.facade.registerCommand(F.TO_LOADING,F),this.facade.registerCommand(F.TO_START,F),this.facade.registerCommand(F.TO_GAME,F),this.facade.registerCommand(F.TO_END,F),this.facade.registerCommand(b.FIRST_TIME_GAME,b),this.facade.registerCommand(b.GAME_START,b),this.facade.registerCommand(b.GAME_OVER,b),this.facade.registerCommand(b.CARD_CHECK,b),this.facade.registerCommand(b.CHECK_OVER_RELATIONSHIP,b),this.facade.registerCommand(b.CHECK_SAME_CARD,b),this.facade.registerCommand(b.CHECK_GAME_OVER,b)},e}(puremvc.SimpleCommand);var Z=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const q=function(t){function e(){return t.call(this)||this}return Z(e,t),e.prototype.initializeMacroCommand=function(){this.addSubCommand(V),this.addSubCommand(z),this.addSubCommand(J)},e}(puremvc.MacroCommand);var Q=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Y=puremvc.Facade;const $=function(t){function e(e){var n=t.call(this,e)||this;return n._application=null,n}return Q(e,t),e.getInstance=function(t){return null==t?null:(null==Y.instanceMap[t]&&(Y.instanceMap[t]=new e(t)),Y.instanceMap[t])},e.prototype.initializeModel=function(){t.prototype.initializeModel.call(this)},e.prototype.initializeView=function(){t.prototype.initializeView.call(this)},e.prototype.initializeController=function(){t.prototype.initializeController.call(this),this.registerCommand(e.STARTUP,q)},e.prototype.startup=function(){var t=document.documentElement.clientWidth||document.body.clientWidth,o=document.documentElement.clientHeight||document.body.clientHeight,r=o>t?o/t*640:t/o*640;globalThis.__PIXI_APP__=this.application=new n({width:640,height:r,backgroundColor:window.themeColor}),this.sendNotification(e.STARTUP,this.application),this.removeCommand(e.STARTUP),this.sendNotification(F.TO_LOADING,{from:null})},e.prototype.destroy=function(){this.application&&(this.application.destroy(!0),this.application=null),TweenMax.killAll()},Object.defineProperty(e.prototype,"application",{get:function(){return this._application},set:function(t){this._application=t},enumerable:!1,configurable:!0}),e.STARTUP="startup",e.instance=null,e}(Y);window.themeColor=13383551,$.getInstance(n.NAME).startup()})();